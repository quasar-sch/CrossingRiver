<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ v1.2</title>

<style>
:root{
  --bg:#f4fbff; --ink:#1f2937; --accent:#0ea5e9; --card:#ffffffcc;
}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,sans-serif;
  background:var(--bg); color:var(--ink);
}
.hidden{display:none!important}
.center-col{
  min-height:100dvh; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:16px
}
.btn{
  padding:12px 18px; border-radius:14px; border:1px solid #dbe5ef;
  font-size:16px; font-weight:700; cursor:pointer;
  background:#fff; box-shadow:0 6px 14px rgba(0,0,0,.06);
}
.btn.primary{background:linear-gradient(#38bdf8,#0ea5e9);color:#fff;border:none}
.btn.next{background:linear-gradient(#34d399,#059669);color:#fff;border:none}

.container{max-width:1100px;margin:0 auto;padding:20px}
.hud{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;margin:10px 0}
.pill{padding:6px 10px;border-radius:999px;background:#eef6ff;color:#1d4ed8;border:1px solid #c7dbff;font-weight:700}

.rule-banner{
  margin:8px 0 14px; padding:10px 14px;
  border-radius:12px; background:#ffffffcc;
  border:1px solid #dbe5ef; box-shadow:0 6px 14px rgba(0,0,0,.06);
  font-size:14px; line-height:1.4;
}

/* ===== ë³´ë“œ ===== */
.board{
  position:relative;width:100%;height:540px;border-radius:18px;
  overflow:hidden;border:1px solid #e5e7eb;background:#bfe8ff
}
.river{
  position:absolute;top:0;bottom:0;left:50%;
  transform:translateX(-50%);width:50%;
  background:linear-gradient(#8dd7ff,#54b9f0 60%,#4aa8e0)
}
.bank{
  position:absolute;top:0;bottom:0;width:25%;
  display:flex;flex-direction:column;justify-content:flex-end;
  gap:8px;padding:10px 12px 28px;
  background:linear-gradient(#cfe9a6,#a7d47d);z-index:1
}
.bank.left{left:0}.bank.right{right:0}
.bank-title{
  position:absolute;top:8px;left:50%;transform:translateX(-50%);
  font-weight:800;background:#ffffffcc;padding:2px 10px;border-radius:999px
}
.dock{display:flex;flex-wrap:wrap;gap:8px}

/* ===== ë°° ===== */
.boat-wrap{
  position:absolute;top:calc(58% - 165px);
  transform:translate(-50%,-50%);
  transition:left 1.1s cubic-bezier(.65,0,.35,1);
  z-index:2
}
.boat-wrap.moving{animation:bob .5s ease-in-out infinite alternate}
@keyframes bob{
  from{transform:translate(-50%,-50%) rotate(-1deg)}
  to{transform:translate(-50%,-52%) rotate(1deg)}
}
.boat{
  position:relative;width:360px;height:110px;
  background:#8b5a2b;border-radius:14px
}
.slots{
  position:absolute; inset:8px;
  display:flex; gap:10px; justify-content:center; align-items:flex-end;
}
.slot{
  width:88px;height:88px;border:2px dashed #ffffff99;
  border-radius:12px;background:#ffffff22;
  box-sizing:border-box;
}

/* ===== í† í° ===== */
.token{
  width:88px;height:88px;border-radius:16px;
  background:var(--card);border:1px solid #e5e7eb;
  box-shadow:0 6px 12px rgba(0,0,0,.08);
  display:flex;align-items:center;justify-content:center;
  font-size:40px; cursor:pointer;
  user-select:none; touch-action:manipulation;
}
.token:active{transform:scale(.96)}

/* ===== ê²°ê³¼ ===== */
.result{
  position:absolute;inset:0;background:rgba(0,0,0,.45);
  display:none;align-items:center;justify-content:center;z-index:10
}
.result .card{
  background:#fff;border-radius:18px;padding:24px;
  width:min(560px,88vw);text-align:center
}

/* ===== ìŠ¤í…Œì´ì§€ë³„ ë³´íŠ¸ ===== */
.boat.two #slotC,.boat.two #slotD{display:none}

.boat.big{width:460px;height:210px}
.boat.big .slots{
  inset:20px 16px 10px 16px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:12px;
  place-items:center;
  align-content:center;
}
</style>
</head>

<body>

<main id="menu" class="center-col">
  <h1>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ</h1>
  <button class="btn primary" id="startBtn">ê²Œì„ ì‹œì‘</button>
</main>

<section id="game" class="container hidden">
  <div class="hud">
    <div>
      <span class="pill">ìŠ¤í…Œì´ì§€: <b id="stageName"></b></span>
      <span class="pill">ë³´íŠ¸ ìœ„ì¹˜: <b id="boatSideLabel"></b></span>
      <span class="pill">ê²½ê³¼ì‹œê°„: <b id="elapsed">0:00</b></span>
    </div>
    <div>
      <button class="btn" id="resetBtn">â†º ë¦¬ì…‹</button>
      <button class="btn primary" id="moveBtn">â›µ ì´ë™</button>
    </div>
  </div>

  <div class="rule-banner" id="ruleBanner"></div>

  <div class="board">
    <div class="bank left">
      <div class="bank-title">ì™¼ìª½ ë‘‘</div>
      <div class="dock" id="dock-left"></div>
    </div>

    <div class="river"></div>

    <div class="boat-wrap" id="boatWrap">
      <div class="boat two" id="boat">
        <div class="slots">
          <div class="slot" id="slotA"></div>
          <div class="slot" id="slotB"></div>
          <div class="slot" id="slotC"></div>
          <div class="slot" id="slotD"></div>
        </div>
      </div>
    </div>

    <div class="bank right">
      <div class="bank-title">ì˜¤ë¥¸ìª½ ë‘‘</div>
      <div class="dock" id="dock-right"></div>
    </div>

    <div class="result" id="overlay">
      <div class="card">
        <h2 id="overlayTitle"></h2>
        <p id="overlayMsg"></p>
        <button class="btn next" id="nextBtn">ë‹¤ìŒ</button>
        <button class="btn primary" id="replayBtn">ë‹¤ì‹œ</button>
      </div>
    </div>
  </div>
</section>

<script>
/* ===== ìŠ¤í…Œì´ì§€ ì •ì˜(ìƒëµ ì—†ì´ ìœ ì§€) ===== */
const STAGES=[
 {name:"5ë‹¨ê³„ Â· ì¡°ë ¨ì‚¬ì™€ ë™ë¬¼ë“¤",
  tokens:["Trainer","Elephant","Tiger","Dog","Cat","Mouse"],
  capacity:4, requiresPerson:true,
  ruleText:"ë°° ì´ë™ì€ í•­ìƒ ì¡°ë ¨ì‚¬ ë™ìŠ¹ í•„ìš”. ë°° ì•ˆ: ì½”ë¼ë¦¬ëŠ” ì¥ ì™¸ ë™ë¬¼ê³¼ ë™ìŠ¹ ë¶ˆê°€, í˜¸ë‘ì´-ê°•ì•„ì§€ ë¶ˆê°€. ë‘‘: ì¡°ë ¨ì‚¬ ì—†ìœ¼ë©´ ìˆœí™˜ ì‹¸ì›€.",
  rules:(pos,side)=>{
    const here=s=>Object.entries(pos).filter(([k,v])=>(v==="BOAT"?side:v)===s).map(([k])=>k);
    const boat=Object.entries(pos).filter(([k,v])=>v==="BOAT").map(([k])=>k);
    if(boat.includes("Trainer")){
      if(boat.includes("Elephant") && boat.some(x=>!["Elephant","Mouse","Trainer"].includes(x)))
        return "ë°° ì•ˆ: ì½”ë¼ë¦¬ëŠ” ì¥ ì™¸ ë™ë¬¼ê³¼ ë™ìŠ¹ ë¶ˆê°€";
      if(boat.includes("Tiger") && boat.includes("Dog"))
        return "ë°° ì•ˆ: í˜¸ë‘ì´ì™€ ê°•ì•„ì§€ëŠ” í•¨ê»˜ íƒˆ ìˆ˜ ì—†ìŒ";
    }
    const pairs=[["Elephant","Tiger"],["Tiger","Dog"],["Dog","Cat"],["Cat","Mouse"],["Mouse","Elephant"]];
    for(const s of["L","R"]){
      const h=here(s); if(!h.includes("Trainer"))
        for(const[p,q] of pairs) if(h.includes(p)&&h.includes(q))
          return `${s==="L"?"ì™¼ìª½":"ì˜¤ë¥¸ìª½"}: ${p}-${q} ì‹¸ì›€`;
    }
    return null;
  }}
];

const $=s=>document.querySelector(s);
let state={stageIndex:0,positions:{},boatSide:"L",moving:false,startTs:null,timer:null};

function emoji(n){
  return {Trainer:"ğŸ‘¨",Elephant:"ğŸ˜",Tiger:"ğŸ…",Dog:"ğŸ•",Cat:"ğŸˆ",Mouse:"ğŸ­"}[n]||"â“";
}

function makeToken(name){
  const el=document.createElement("div");
  el.className="token"; el.textContent=emoji(name);
  el.onclick=()=>toggleToken(name);
  return el;
}

function toggleToken(name){
  if(state.moving||$("#overlay").style.display==="flex")return;
  const st=STAGES[state.stageIndex];
  const pos=state.positions[name];

  if(pos==="BOAT"){ state.positions[name]=state.boatSide; return render(); }
  if(pos===state.boatSide && Object.values(state.positions).filter(v=>v==="BOAT").length<st.capacity){
    state.positions[name]="BOAT"; return render();
  }
}

function adjustBoat(){
  const st=STAGES[state.stageIndex];
  const boat=$("#boat");
  boat.classList.toggle("big",st.capacity===4);
  boat.classList.toggle("two",st.capacity===2);
}

function render(){
  $("#dock-left").innerHTML="";
  $("#dock-right").innerHTML="";
  document.querySelectorAll(".slot").forEach(s=>s.innerHTML="");
  adjustBoat();

  const st=STAGES[state.stageIndex];
  for(const t of st.tokens){
    const el=makeToken(t);
    const p=state.positions[t];
    if(p==="L")$("#dock-left").appendChild(el);
    else if(p==="R")$("#dock-right").appendChild(el);
    else document.querySelector(".slot:empty")?.appendChild(el);
  }

  $("#stageName").textContent=st.name;
  $("#ruleBanner").textContent=st.ruleText;
  $("#boatSideLabel").textContent=state.boatSide==="L"?"ì™¼ìª½":"ì˜¤ë¥¸ìª½";

  const fail=st.rules(state.positions,state.boatSide);
  if(fail)return showOverlay(false,fail);
  if(Object.values(state.positions).every(v=>v==="R"))
    showOverlay(true,"ì„±ê³µ!");
}

function moveBoat(){
  if(state.moving)return;
  const st=STAGES[state.stageIndex];
  if(!Object.values(state.positions).includes("BOAT"))return;
  if(st.requiresPerson && state.positions.Trainer!=="BOAT")return;

  state.boatSide=state.boatSide==="L"?"R":"L";
  state.moving=true;
  $("#boatWrap").style.left=state.boatSide==="L"?"35%":"65%";
  setTimeout(()=>{
    for(const k in state.positions)
      if(state.positions[k]==="BOAT") state.positions[k]=state.boatSide;
    state.moving=false; render();
  },1100);
}

function showOverlay(ok,msg){
  $("#overlayTitle").textContent=ok?"ì„±ê³µ":"ì‹¤íŒ¨";
  $("#overlayMsg").textContent=msg;
  $("#overlay").style.display="flex";
}

function startStage(){
  const st=STAGES[0];
  state.positions={}; st.tokens.forEach(t=>state.positions[t]="L");
  state.boatSide="L";
  $("#overlay").style.display="none";
  render();
}

$("#startBtn").onclick=()=>{$("#menu").classList.add("hidden");$("#game").classList.remove("hidden");startStage()};
$("#moveBtn").onclick=moveBoat;
$("#resetBtn").onclick=startStage;
$("#replayBtn").onclick=()=>{$("#overlay").style.display="none";startStage()};
</script>

</body>
</html>

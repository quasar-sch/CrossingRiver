<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ v1.1</title>

<style>
:root{
  --bg:#f4fbff;
  --ink:#1f2937;
  --accent:#0ea5e9;
  --card:#ffffffcc;
}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,sans-serif;
  background:var(--bg);
  color:var(--ink)
}
.hidden{display:none!important}
.center-col{
  min-height:100dvh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:16px
}
.btn{
  padding:12px 18px;
  border-radius:14px;
  border:1px solid #dbe5ef;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  background:#fff;
  box-shadow:0 6px 14px rgba(0,0,0,.06);
}
.btn.primary{
  background:linear-gradient(180deg,#38bdf8,#0ea5e9);
  color:#fff;
  border:none
}
.btn.next{
  background:linear-gradient(180deg,#34d399,#059669);
  color:#fff;
  border:none
}

.container{max-width:1100px;margin:0 auto;padding:20px}

.hud{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  margin:10px 0
}
.pill{
  padding:6px 10px;
  border-radius:999px;
  background:#eef6ff;
  color:#1d4ed8;
  border:1px solid #c7dbff;
  font-weight:700
}

/* ê·œì¹™ ë°°ë„ˆ */
.rule-banner{
  margin:8px 0 14px;
  padding:10px 14px;
  border-radius:12px;
  background:#ffffffcc;
  border:1px solid #dbe5ef;
  box-shadow:0 6px 14px rgba(0,0,0,.06);
  font-size:14px;
  line-height:1.4
}

/* ë³´ë“œ */
.board{
  position:relative;
  width:100%;
  height:540px;
  border-radius:18px;
  overflow:hidden;
  border:1px solid #e5e7eb;
  background:#bfe8ff
}
.river{
  position:absolute;
  top:0;bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:50%;
  background:linear-gradient(180deg,#8dd7ff,#54b9f0 60%,#4aa8e0)
}
.bank{
  position:absolute;
  top:0;bottom:0;
  width:25%;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  gap:8px;
  padding:10px 12px 28px;
  background:linear-gradient(#cfe9a6,#a7d47d);
  z-index:1
}
.bank.left{left:0}
.bank.right{right:0}
.bank-title{
  position:absolute;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  font-weight:800;
  background:#ffffffcc;
  padding:2px 10px;
  border-radius:999px
}
.dock{display:flex;flex-wrap:wrap;gap:8px}

/* ë³´íŠ¸ */
.boat-wrap{
  position:absolute;
  top:calc(58% - 165px);
  transform:translate(-50%,-50%);
  transition:left 1.1s cubic-bezier(.65,0,.35,1);
  z-index:2
}
.boat-wrap.moving{animation:bob .5s ease-in-out infinite alternate}
@keyframes bob{
  from{transform:translate(-50%,-50%) rotate(-1deg)}
  to{transform:translate(-50%,-52%) rotate(1deg)}
}

.boat{
  position:relative;
  background:#8b5a2b;
  border-radius:12px
}

/* ìŠ¬ë¡¯ ê³µí†µ */
.slots{
  position:absolute;
  display:flex;
  gap:10px;
  justify-content:center;
  align-items:flex-end
}
.slot{
  width:88px;
  height:88px;
  border:2px dashed #ffffff99;
  border-radius:12px;
  background:#ffffff22;
  display:flex;
  align-items:center;
  justify-content:center
}

/* í† í° */
.token{
  width:88px;
  height:88px;
  border-radius:16px;
  background:var(--card);
  border:1px solid #e5e7eb;
  box-shadow:0 6px 12px rgba(0,0,0,.08);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  cursor:grab
}

/* ë‹¨ê³„ë³„ ë³´íŠ¸ */
.boat.two{
  width:360px;
  height:110px
}
.boat.two .slots{
  left:8px;
  right:8px;
  bottom:8px;
  height:96px;
}
.boat.two #slotC,
.boat.two #slotD{display:none}

/* ğŸ”§ Stage 5 í° ë³´íŠ¸ */
.boat.big{
  width:460px;
  height:210px
}
.boat.big .slots{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:12px;
  left:16px;
  right:16px;

  /* âœ… ìŠ¬ë¡¯ì„ ì•„ë˜ë¡œ ë‚´ë ¤ì„œ ë°° ë‚´ë¶€ì— ë§ì¶¤ */
  bottom:4px;

  justify-items:center;
  align-items:end;
}

/* ì˜¤ë²„ë ˆì´ */
.result{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10
}
.result .card{
  background:#fff;
  border-radius:18px;
  padding:24px;
  width:min(560px,88vw);
  text-align:center
}
</style>
</head>

<body>

<main id="menu" class="center-col">
  <h1>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ</h1>
  <button class="btn primary" id="startBtn">ê²Œì„ ì‹œì‘</button>
</main>

<section id="game" class="container hidden">
  <div class="hud">
    <div>
      <span class="pill">ìŠ¤í…Œì´ì§€: <b id="stageName"></b></span>
      <span class="pill">ë³´íŠ¸ ìœ„ì¹˜: <b id="boatSideLabel"></b></span>
      <span class="pill">ì‹œê°„: <b id="elapsed">00:00</b></span>
    </div>
    <div>
      <button class="btn" id="resetBtn">ë¦¬ì…‹</button>
      <button class="btn primary" id="moveBtn">ì´ë™</button>
    </div>
  </div>

  <div class="rule-banner" id="ruleBanner"></div>

  <div class="board">
    <div class="bank left">
      <div class="bank-title">ì™¼ìª½ ë‘‘</div>
      <div class="dock" id="dock-left"></div>
    </div>

    <div class="river"></div>

    <div class="boat-wrap" id="boatWrap">
      <div class="boat" id="boat">
        <div class="slots">
          <div class="slot" id="slotA"></div>
          <div class="slot" id="slotB"></div>
          <div class="slot" id="slotC"></div>
          <div class="slot" id="slotD"></div>
        </div>
      </div>
    </div>

    <div class="bank right">
      <div class="bank-title">ì˜¤ë¥¸ìª½ ë‘‘</div>
      <div class="dock" id="dock-right"></div>
    </div>
  </div>
</section>

<script>
const STAGES=[
 {name:"5ë‹¨ê³„ Â· ì¡°ë ¨ì‚¬ì™€ ë™ë¬¼ë“¤",
  tokens:["Trainer","Elephant","Tiger","Dog","Cat","Mouse"],
  capacity:4,
  requiresPerson:true,
  ruleText:"Stage 5 í…ŒìŠ¤íŠ¸"}
];

const $=s=>document.querySelector(s);
let state={
  stageIndex:0,
  positions:{},
  boatSide:"L",
  moving:false,
  startTs:null,
  timerId:null
};

const boatWrap=$("#boatWrap");
const boat=$("#boat");
const leftDock=$("#dock-left");
const rightDock=$("#dock-right");

/* âœ… Stageë³„ ë³´íŠ¸ ìœ„ì¹˜ ë³´ì • */
function boatLeftPercent(side){
  const isBig = STAGES[state.stageIndex].capacity===4;
  if(isBig){
    return side==="L" ? 40 : 60;
  }
  return side==="L" ? 35 : 65;
}

function emoji(n){
  return {Trainer:"ğŸ‘¨",Elephant:"ğŸ˜",Tiger:"ğŸ…",Dog:"ğŸ•",Cat:"ğŸˆ",Mouse:"ğŸ­"}[n];
}

function makeToken(n){
  const el=document.createElement("div");
  el.className="token";
  el.textContent=emoji(n);
  el.onclick=()=>{
    if(state.positions[n]==="BOAT") state.positions[n]=state.boatSide;
    else if(state.positions[n]===state.boatSide) state.positions[n]="BOAT";
    render();
  };
  return el;
}

function adjustBoat(){
  boat.className="boat big";
}

function render(){
  leftDock.innerHTML="";
  rightDock.innerHTML="";
  document.querySelectorAll(".slot").forEach(s=>s.innerHTML="");

  adjustBoat();

  for(const t of STAGES[0].tokens){
    const el=makeToken(t);
    if(state.positions[t]==="L") leftDock.appendChild(el);
    else if(state.positions[t]==="R") rightDock.appendChild(el);
    else document.querySelector(".slot:empty")?.appendChild(el);
  }

  $("#stageName").textContent=STAGES[0].name;
  $("#ruleBanner").textContent=STAGES[0].ruleText;
  $("#boatSideLabel").textContent=state.boatSide==="L"?"ì™¼ìª½":"ì˜¤ë¥¸ìª½";
  boatWrap.style.left=boatLeftPercent(state.boatSide)+"%";
}

function start(){
  STAGES[0].tokens.forEach(t=>state.positions[t]="L");
  render();
}

$("#startBtn").onclick=()=>{
  $("#menu").classList.add("hidden");
  $("#game").classList.remove("hidden");
  start();
};

$("#moveBtn").onclick=()=>{
  state.boatSide=state.boatSide==="L"?"R":"L";
  boatWrap.style.left=boatLeftPercent(state.boatSide)+"%";
};

$("#resetBtn").onclick=start;
</script>

</body>
</html>
